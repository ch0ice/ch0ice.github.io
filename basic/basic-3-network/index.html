<!DOCTYPE html><html class="theme-next pisces use-motion" lang="zh-Hans"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta name="theme-color" content="#222"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css"><link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic|Damion:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css"><link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css"><link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.ico?v=5.1.4"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.ico?v=5.1.4"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.ico?v=5.1.4"><link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222"><meta name="keywords" content="计算机基础,网络协议,互联网,"><link rel="alternate" href="/atom.xml" title="Choice's Blog" type="application/atom+xml"><meta name="description" content="前言我们每天都在使用互联网，通过互联网聊天、购物、听音乐、看电影，全世界有几十亿台电脑通过互联网两两交互，那什么是互联网呢？互联网的核心是一系列协议，总称为互联网协议（Internet Protocol Suite），它们对电脑如何连接和组网，做出了详尽的规定，理解了这些协议，就理解了互联网的交互原理。 网络模型划分计算机网络的各层及其协议的集合被称为网络的体系结构，按照不同的维度，其常被分为七层"><meta name="keywords" content="计算机基础,网络协议,互联网"><meta property="og:type" content="article"><meta property="og:title" content="计算机基础(3) --- 网络协议"><meta property="og:url" content="http://blog.onlinetool.com.cn/basic/basic-3-network/index.html"><meta property="og:site_name" content="Choice&#39;s Blog"><meta property="og:description" content="前言我们每天都在使用互联网，通过互联网聊天、购物、听音乐、看电影，全世界有几十亿台电脑通过互联网两两交互，那什么是互联网呢？互联网的核心是一系列协议，总称为互联网协议（Internet Protocol Suite），它们对电脑如何连接和组网，做出了详尽的规定，理解了这些协议，就理解了互联网的交互原理。 网络模型划分计算机网络的各层及其协议的集合被称为网络的体系结构，按照不同的维度，其常被分为七层"><meta property="og:locale" content="zh-Hans"><meta property="og:image" content="http://blog.onlinetool.com.cn/images/basic/basic-3-network-interaction.png"><meta property="og:image" content="http://blog.onlinetool.com.cn/images/basic/basic-3-network-model.png"><meta property="og:image" content="http://blog.onlinetool.com.cn/images/basic/basic-3-network-ethernet.png"><meta property="og:image" content="http://blog.onlinetool.com.cn/images/basic/basic-3-network-subnet.png"><meta property="og:image" content="http://blog.onlinetool.com.cn//images/basic/basic-3-network-ip.png"><meta property="og:image" content="http://blog.onlinetool.com.cn/images/basic/basic-3-network-ethernet+ip.png"><meta property="og:image" content="http://blog.onlinetool.com.cn/images/basic/basic-3-network-arp.png"><meta property="og:image" content="http://blog.onlinetool.com.cn/images/basic/basic-3-network-ethernet+arp.png"><meta property="og:image" content="http://blog.onlinetool.com.cn/images/basic/basic-3-network-udp.png"><meta property="og:image" content="http://blog.onlinetool.com.cn/images/basic/basic-3-network-ethernet+ip+udp.png"><meta property="og:image" content="http://blog.onlinetool.com.cn/images/basic/basic-3-network-tcp.png"><meta property="og:image" content="http://blog.onlinetool.com.cn/images/basic/basic-3-network-ethernet+ip+tcp.png"><meta property="og:image" content="http://blog.onlinetool.com.cn/images/basic/basic-3-network-tcp-link.png"><meta property="og:image" content="http://blog.onlinetool.com.cn/images/basic/basic-3-network-ethernet+application.png"><meta property="og:image" content="http://blog.onlinetool.com.cn/images/basic/basic-3-network-dhcp.png"><meta property="og:image" content="http://blog.onlinetool.com.cn/images/basic/basic-3-network-ethernet+ip+udp+dhcp.png"><meta property="og:image" content="http://blog.onlinetool.com.cn/images/basic/basic-3-network-dns.png"><meta property="og:image" content="http://blog.onlinetool.com.cn/images/basic/basic-3-network-ethernet+ip+udp+tcp+dns.png"><meta property="og:updated_time" content="2020-09-25T03:37:14.684Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="计算机基础(3) --- 网络协议"><meta name="twitter:description" content="前言我们每天都在使用互联网，通过互联网聊天、购物、听音乐、看电影，全世界有几十亿台电脑通过互联网两两交互，那什么是互联网呢？互联网的核心是一系列协议，总称为互联网协议（Internet Protocol Suite），它们对电脑如何连接和组网，做出了详尽的规定，理解了这些协议，就理解了互联网的交互原理。 网络模型划分计算机网络的各层及其协议的集合被称为网络的体系结构，按照不同的维度，其常被分为七层"><meta name="twitter:image" content="http://blog.onlinetool.com.cn/images/basic/basic-3-network-interaction.png"><script type="text/javascript" id="hexo.configurations">var NexT=window.NexT||{},CONFIG={root:"/",scheme:"Pisces",version:"5.1.4",sidebar:{position:"left",display:"post",offset:12,b2t:!1,scrollpercent:!1,onmobile:!1},fancybox:!0,tabs:!0,motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}},duoshuo:{userId:"0",author:"博主"},algolia:{applicationID:"",apiKey:"",indexName:"",hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}}}</script><link rel="canonical" href="http://blog.onlinetool.com.cn/basic/basic-3-network/"><title>计算机基础(3) --- 网络协议 | Choice's Blog</title><script type="text/javascript">var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?90aa63e8cd3863bfdba1f3fdfcd619c1";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script></head><body itemscope="" itemtype="http://schema.org/WebPage" lang="zh-Hans"><div class="container sidebar-position-left page-post-detail"><div class="headband"> <a href="https://github.com/ch0ice" class="github-corner" aria-label="View source on Github" rel="external nofollow noopener noreferrer" target="_blank"><svg width="80" height="80" viewbox="0 0 250 250" style="fill:#151513;color:#fff;position:absolute;top:0;border:0;right:0" aria-hidden="true"><path d="M0 0 115 115 130 115 142 142 250 250 250 0Z"/><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"/><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4L133.7 101.6C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8Z" fill="currentColor" class="octo-body"/></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style></div><header id="header" class="header" itemscope="" itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-wrapper"><div class="site-meta"><div class="custom-logo-site-title"><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">Choice's Blog</span><span class="logo-line-after"><i></i></span></a></div><h1 class="site-subtitle" itemprop="description"></h1></div><div class="site-nav-toggle"> <button><span class="btn-bar"></span><span class="btn-bar"></span><span class="btn-bar"></span></button></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i><br> 首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="menu-item-icon fa fa-fw fa-user"></i><br> 关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i><br> 标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i><br> 分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i><br> 归档</a></li><li class="menu-item menu-item-sitemap"><a href="/sitemap.xml" rel="section"><i class="menu-item-icon fa fa-fw fa-sitemap"></i><br> 站点地图</a></li><li class="menu-item menu-item-search"><a href="javascript:;" class="popup-trigger"><i class="menu-item-icon fa fa-search fa-fw"></i><br> 搜索</a></li></ul><div class="site-search"><div class="popup search-popup local-search-popup"><div class="local-search-header clearfix"><span class="search-icon"><i class="fa fa-search"></i></span><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span><div class="local-search-input-wrapper"> <input autocomplete="off" placeholder="搜索..." spellcheck="false" type="text" id="local-search-input"></div></div><div id="local-search-result"></div></div></div></nav></div></header><main id="main" class="main"><div class="main-inner"><div class="content-wrap"><div id="content" class="content"><div id="posts" class="posts-expand"><article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article"><div class="post-block"><link itemprop="mainEntityOfPage" href="http://blog.onlinetool.com.cn/basic/basic-3-network/"><span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person"><meta itemprop="name" content="Choice"><meta itemprop="description" content=""><meta itemprop="image" content="/uploads/portrait.png"></span><span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization"><meta itemprop="name" content="Choice's Blog"></span><header class="post-header"><h2 class="post-title" itemprop="name headline">计算机基础(3) --- 网络协议</h2><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-06-12T13:29:40+08:00">2020-06-12</time> <span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-calendar-check-o"></i></span> <span class="post-meta-item-text">更新于&#58;</span> <time title="更新于" itemprop="dateModified" datetime="2020-09-25T11:37:14+08:00">2020-09-25</time></span> <span class="post-category"><span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-folder-o"></i></span> <span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/计算机基础/" itemprop="url" rel="index"><span itemprop="name">计算机基础</span></a></span></span> <span class="post-comments-count"><span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-comment-o"></i></span><a href="/basic/basic-3-network/#comments" itemprop="discussionUrl"><span class="post-comments-count valine-comment-count" data-xid="/basic/basic-3-network/" itemprop="commentCount"></span></a></span><div class="post-wordcount"><span class="post-meta-item-icon"><i class="fa fa-file-word-o"></i></span> <span class="post-meta-item-text">字数统计&#58;</span> <span title="字数统计">5,925</span> <span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-clock-o"></i></span> <span class="post-meta-item-text">阅读时长 &asymp;</span> <span title="阅读时长">21</span></div></div></header><div class="post-body" itemprop="articleBody"><h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>我们每天都在使用互联网，通过互联网聊天、购物、听音乐、看电影，全世界有几十亿台电脑通过互联网两两交互，那什么是互联网呢？<br>互联网的核心是一系列协议，总称为<strong>互联网协议（Internet Protocol Suite）</strong>，它们对电脑如何连接和组网，做出了详尽的规定，理解了这些协议，就理解了互联网的交互原理。<br><img src="/basic/basic-3-network/../../images/basic/basic-3-network-interaction.png" alt="" title="互联网交互图"></p><h1 id="网络模型划分"><a href="#网络模型划分" class="headerlink" title="网络模型划分"></a>网络模型划分</h1><p>计算机网络的各层及其协议的集合被称为网络的体系结构，按照不同的维度，其常被分为七层、五层、四层网络结构，如下图所示：<br><img src="/basic/basic-3-network/../../images/basic/basic-3-network-model.png" alt="" title="网络层次划分"></p><h1 id="七层网络模型-—-OSI（Open-System-Interconnection）"><a href="#七层网络模型-—-OSI（Open-System-Interconnection）" class="headerlink" title="七层网络模型 — OSI（Open System Interconnection）"></a>七层网络模型 — OSI（Open System Interconnection）</h1><p>OSI — 开放式系统互联模型是一种概念模型，由国际标准化组织提出，并试图成为计算机在世界范围内互连为网络的标准框架，它具有七层网络结构。</p><h1 id="四层网络模型-—-TCP-IP"><a href="#四层网络模型-—-TCP-IP" class="headerlink" title="四层网络模型 — TCP/IP"></a>四层网络模型 — TCP/IP</h1><p>互联网协议套件（Internet Protocol Suite，IPS）是多个网络传输协议的集合，它为网际网络的基础通信提供架构支撑，由于该协议族中最核心的两个协议分别为 TCP（传输控制协议）和 IP（网际协议），因此它也被称为 TCP/IP 协议族，简称TCP/IP，它具有四层网络结构。</p><h1 id="五层网络模型-—-TCP-IP"><a href="#五层网络模型-—-TCP-IP" class="headerlink" title="五层网络模型 — TCP/IP"></a>五层网络模型 — TCP/IP</h1><p>OSI模型由国际标准化组织进行制定，它是正统意义上的国际标准，但其实现过于复杂、制定周期过长，在其整套标准推出之前，TCP/IP模型已经在全球范围内被广泛使用，所以 TCP/IP 模型才是事实上的国际标准。<br>TCP/IP 模型定义了应用层、传输层、网际层、网络接口层这四层网络结构，但并没有给出网络接口层的具体内容，因此在学习和开发中，通常将网络接口层替换为OSI七层模型中的数据链路层和物理层来进行理解，由此产生TCP/IP五层网络模型。<br>下面我们会对五层网络模型从下至上展开详细讲解。</p><h2 id="物理层（Physical-Layer）"><a href="#物理层（Physical-Layer）" class="headerlink" title="物理层（Physical Layer）"></a>物理层（Physical Layer）</h2><p>电脑之间组网第一件事是通过网卡、网线、集线器、中继器、调制解调器、光缆、电缆、双绞线、无线电波等物理设备将电脑之间连接起来。<br>这就是物理层，是把电脑之间连接起来的物理手段，该层为上层协议提供了一个传输数据的可靠的物理媒体，它规定了网络的一些电气特性，比如高电压1、低电压0，组成比特流进行传输。</p><h2 id="数据链路层（Data-Link-Layer）"><a href="#数据链路层（Data-Link-Layer）" class="headerlink" title="数据链路层（Data Link Layer）"></a>数据链路层（Data Link Layer）</h2><p>数据链路层在物理层提供的服务的基础上向网络层提供服务，物理层单纯的电信号0和1没有任何意义，必需规定解读方式，如电信号多少位一组、每组什么意思，它规定了电信号的分组方式，以及物理寻址（MAC），将源自网络层来的数据可靠地传输到相邻节点的目标主机的网络层（广播）。</p><h3 id="以太网协议（Ethernet-Protocol）"><a href="#以太网协议（Ethernet-Protocol）" class="headerlink" title="以太网协议（Ethernet Protocol）"></a>以太网协议（Ethernet Protocol）</h3><p>早期的时候各个公司都有自己的分组方式、后来形成了统一的分组成帧标准，即以太网协议。<br>以太网规定，一组电信号构成一个数据包，叫做”帧”（Frame），每一帧分成两个部分：报头（Head）和数据（Data）。<br><img src="/basic/basic-3-network/../../images/basic/basic-3-network-ethernet.png" alt="" title="以太网协议结构"><br>Head部分为定长18字节，Data部分为46 ~ 1500字节，因此单帧最小长度为64字节（head 18 + data 46）， 单帧最大长度为1518字节（head 18 + data 1500），如果超出最大长度就分割成多个帧进行发送。</p><h3 id="MAC地址（Media-Access-Control-Address）"><a href="#MAC地址（Media-Access-Control-Address）" class="headerlink" title="MAC地址（Media Access Control Address）"></a>MAC地址（Media Access Control Address）</h3><p>上面提到以太网数据包（Frame）的报头（Head）中包含源地址和目标地址信息就是网卡地址，即MAC地址。<br>每块网卡出厂时都有一个全世界独一无二的MAC地址，长度为6字节48位，通常用12个十六进制数表示，前6个十六进制数是厂商编号，后6个是该厂商的网卡流水号。<br>有了MAC地址，就可以定位网卡和数据包的路径了。</p><h3 id="广播（Broadcasting）"><a href="#广播（Broadcasting）" class="headerlink" title="广播（Broadcasting）"></a>广播（Broadcasting）</h3><p>我们现在知道了以太网数据包（Frame）的报头（Head）中包含的地址信息是MAC地址，我们知道本机网卡的MAC地址，但是我们还需要获取对端主机网卡的MAC地址，怎么获取呢？<br>答案是通过一种叫ARP的协议（下面会讲），我们可以得到对端主机网卡的MAC地址，但是怎么才能把数据包准确送到接收方呢？<br>答案是以太网采用了一种很”原始”的方式，它不是把数据包准确送到接收方，而是向本网络内所有主机发送，让每台计算机自己判断自己是否为接收方，它们读取这个包的”标头”找到接收方的MAC地址，然后与自身的MAC地址相比较，如果两者相同，就接受这个包做进一步处理，否则就丢弃这个包，这种发送方式就叫做”广播”（broadcasting）。</p><h2 id="网络层（Network-Layer）"><a href="#网络层（Network-Layer）" class="headerlink" title="网络层（Network Layer）"></a>网络层（Network Layer）</h2><p>有了以太网数据包的定义、网卡的MAC地址、广播的发送方式，世界上的计算机就可以彼此通信了。<br>问题是互联网是由一个个彼此隔离的子网组成的，<strong>广播出去的消息只有在同一子网内的主机才会收到</strong>，两个主机不在同一子网对端是收不到的，这种设计是合理的，如果一台主机发送的包全世界都会收到，这就不仅仅是效率低的问题了，这将会是一种灾难。<br><img src="/basic/basic-3-network/../../images/basic/basic-3-network-subnet.png" alt="" title="互联网子网关系图"><br>因此，必须找到一种方法，能够区分哪些MAC地址属于同一个子网络，哪些不是。如果是同一个子网络，就采用广播方式发送，否则就采用路由（向不同广播域/子网分发数据包）方式发送，遗憾的是，MAC地址本身无法做到这一点，它只与厂商有关，与所处网络无关。<br>至此网络层诞生了，它的作用是引进一套新的地址，使得我们能够区分不同的计算机是否属于同一个子网络，这套地址就叫做<strong>网络地址</strong>，简称<strong>网址</strong>。<br>网络层出现以后，每台计算机有了两种地址，一种是MAC地址，另一种是网络地址，两种地址之间没有任何联系，MAC地址是绑定在网卡上的，网络地址则是管理员分配的，它们只是随机组合在一起。<br>网络地址帮助我们确定计算机所在的子网络，MAC地址则将数据包送到该子网络中的目标网卡，因此，从逻辑上可以推断，必定是先处理网络地址，然后再处理MAC地址。</p><h3 id="IP协定"><a href="#IP协定" class="headerlink" title="IP协定"></a>IP协定</h3><p>规定网络地址的协议叫IP协议，它定义的地址称之为IP地址。<br>目前，广泛采用的是IP协议第四版，简称IPv4，IPv4规定网络地址由4字节点分十进制表示。<br>例如：127.0.0.1，范围：0.0.0.0 ~ 255.255.255.255<br>IP地址分成两部分，网络部分(标识子网)和主机部分(标识主机)，如果两个IP地址的网络部分相同，那就说明它们在同一子网内，但是我们不能确定IP地址中哪一部分是用来标识子网的，这就需要一个参数，<strong>子网掩码</strong>。</p><h3 id="子网掩码"><a href="#子网掩码" class="headerlink" title="子网掩码"></a>子网掩码</h3><p>子网掩码就是用来确定IP地址中网络特征的一个参数，它在形式上等同于IP地址，同样是4字节点分十进制表示，转为二进制以后它的网络部分全部为1、主机部分全部为0，然后与IP地址进行按位与（&amp;）运算，就可以得到IP地址中的网络部分。<br>例如：IP地址为：172.20.10.4，子网掩码为：255.255.255.0，那么就代表IP地址中前24位为网络部分，后8位为主机部分，就可以得出IP地址中的网络部分为：172.20.10.0</p><h3 id="IP数据包"><a href="#IP数据包" class="headerlink" title="IP数据包"></a>IP数据包</h3><p>IP数据包也分为Head和Data部分，如下图所示：<br><img src="../..//images/basic/basic-3-network-ip.png" alt="" title="IP数据包结构"><br>IP数据包最大长度为65535字节，为理论上的最大长度，但前面说过以太网数据包的Data部分最长只有1500字节，因此，如果IP数据包超过了1500字节，它就需要分割成多个以太网数据包，分开发送了。<br>以太网协议无须为IP数据包定义单独的栏位，直接放入以太网包的Data部分即可，如下图所示：<br><img src="/basic/basic-3-network/../../images/basic/basic-3-network-ethernet+ip.png" alt="" title="增加IP数据包后的以太网协议结构"></p><h3 id="ARP（Address-Resolution-Protocol）-RARP（Reverse-Address-Resolution-Protocol）"><a href="#ARP（Address-Resolution-Protocol）-RARP（Reverse-Address-Resolution-Protocol）" class="headerlink" title="ARP（Address Resolution Protocol）/RARP（Reverse Address Resolution Protocol）"></a>ARP（Address Resolution Protocol）/RARP（Reverse Address Resolution Protocol）</h3><p>因为IP数据包是放在以太网数据包里发送的，所以我们必须同时知道两个地址，一个是对方的MAC地址，另一个是对方的IP地址，对方的IP地址是已知的，但是我们不知道它的MAC地址，所以我们需要一种机制能够通过IP地址得到MAC地址，<strong>就是ARP — 地址解析协议</strong>。<br><strong>ARP — 地址解析协议</strong>，也是一个数据包，如下所示：<br><img src="/basic/basic-3-network/../../images/basic/basic-3-network-arp.png" alt="" title="ARP数据包结构"><br>ARP数据包同样包含在以太网数据包中，这个包会以广播的方式在发送端所处的子网内传输，在发送时目标主机MAC地址为FF:FF:FF:FF:FF:FF，表示这是一个广播地址，目标主机接收到ARP数据包后从中取出IP地址，与自身的IP地址进行比较，发现目标IP为本身的，就返回本身的MAC地址，否则就丢弃这个包。<br>需要注意的是，如果目标主机不在同一子网，那么ARP数据包中的目标主机IP为本机所在子网的网关IP。<br><img src="/basic/basic-3-network/../../images/basic/basic-3-network-ethernet+arp.png" alt="" title="增加ARP数据包后的以太网协议结构"><br><strong>RARP — 逆地址解析协议</strong>，功能和ARP协议相对，其将局域网中某个主机的MAC地址转换为IP地址。</p><h2 id="传输层（Transport-Layer）"><a href="#传输层（Transport-Layer）" class="headerlink" title="传输层（Transport Layer）"></a>传输层（Transport Layer）</h2><p>网络层的IP帮我们区分子网，数据链路层的MAC帮我们找到主机，然后大家使用的都是应用程序，你的电脑上可能同事运行多个应用程序如播放器、聊天软件等，那么我们通过IP和MAC找到了一台特定的主机，如何标识这台主机上的应用程序呢？<br>答案便是<strong>端口（Port）</strong>，端口即应用程序与网卡关联的编号，每个数据包都发到主机的特定端口，所以不同的程序就能取到自己所需要的数据。<br>端口是一个两字节的整数，范围是0到65535之间，0到1023的端口被系统占用，用户只能选用大于1023的端口，不管是浏览网页还是在线聊天，应用程序会随机选用一个端口，然后与服务器的相应端口联系。<br><strong>传输层的功能就是建立端口到端口的通信</strong>，相比之下<strong>网络层的功能是建立主机到主机的通信</strong>，只要确定主机和端口，我们就能实现程序之间的交流。<br>因此，Unix系统就把主机+端口，叫做Socket（下面会讲），有了它，就可以进行网络应用程序开发了。</p><h3 id="UDP（User-Datagram-Protocol）"><a href="#UDP（User-Datagram-Protocol）" class="headerlink" title="UDP（User Datagram Protocol）"></a>UDP（User Datagram Protocol）</h3><p>有了端口以后，我们必须在数据包中加入端口信息，这就需要新的协议，最简单的实现叫做UDP — 用户数据报协议，它的格式几乎就是在数据前面，加上端口号。<br>UDP数据包，也是由Head和Data两部分组成，UDP数据包总长度最大65535字节，Head部分为定长8字节，Data部分为变长65527字节，如下图所示：<br><img src="/basic/basic-3-network/../../images/basic/basic-3-network-udp.png" alt="" title="UDP数据包结构"><br>UDP数据包需要放在IP数据包的Data部分，IP数据包又是放在以太网数据包之中的，所以整个以太网数据包现在变成了下面这样：<br><img src="/basic/basic-3-network/../../images/basic/basic-3-network-ethernet+ip+udp.png" alt="" title="增加IP数据包和UDP数据包后的以太网协议结构"></p><h3 id="TCP（Transmission-Control-Protocol）"><a href="#TCP（Transmission-Control-Protocol）" class="headerlink" title="TCP（Transmission Control Protocol）"></a>TCP（Transmission Control Protocol）</h3><p>UDP协议的优点是比较简单，容易实现，但是缺点是可靠性较差，一旦数据包发出，无法知道对方是否收到。<br>为了解决这个问题，提高网络可靠性，TCP协议就诞生了，这个协议非常复杂，但可以近似认为，它就是有确认机制的UDP协议，每发出一个数据包都要求确认，如果有一个数据包遗失，收不到确认，发出方就会认为这个包发送失败重新发送这个数据包。<br>因此，TCP协议能够确保数据不会遗失，它的缺点是过程复杂、实现困难、消耗较多的资源。<br><img src="/basic/basic-3-network/../../images/basic/basic-3-network-tcp.png" alt="" title="TCP数据包结构"><br>TCP数据包，也是由Head和Data两部分组成，Head部分为定长20字节加变长4字节扩展，TCP数据包和UDP数据包一样，都是内嵌在IP数据包的Data部分，TCP数据包没有长度限制，理论上可以无限长，但是为了保证网络的效率，通常TCP数据包的长度不会超过IP数据包的长度，以确保单个TCP数据包不必再分割。<br><img src="/basic/basic-3-network/../../images/basic/basic-3-network-ethernet+ip+tcp.png" alt="" title="增加IP数据包和TCP数据包后的以太网协议结构"></p><h4 id="TCP-—-三次握手四次挥手"><a href="#TCP-—-三次握手四次挥手" class="headerlink" title="TCP — 三次握手四次挥手"></a>TCP — 三次握手四次挥手</h4><p>由于我们大部分使用的应用层协议都基于TCP协议通信，所以这里重点讲一下TCP协议。<br>上面说过了，<strong>TCP是基于连接的可靠性传输协议</strong>，TCP提供面向有连接的通信传输，面向有连接是指在数据通信开始之前先做好两端之间的准备工作，由此保证连接的可靠性。<br><img src="/basic/basic-3-network/../../images/basic/basic-3-network-tcp-link.png" alt="" title="TCP三次握手四次挥手"><br>如上图所示，TCP交互有三个阶段，<strong>连接创建、数据传输、连接销毁。</strong><br><strong>连接创建（三次握手）：</strong><br>创建连接需要三次握手，是指建立一个TCP连接时需要客户端和服务器端总共发送三个包以确认连接的建立（Socket编程中，由客户端执行connect函数来触发)。</p><ul><li>第一次握手：Client发送SYN包，请求建立新连接，Server收到Client发送的SYN包，此时Server知道：Client发送能力正常，自己的接收能力正常。</li><li>第二次握手：Server发送ACK包，表示收到Client发送的SYN包并同意创建新连接，Client收到Server发送的ACK包，此时Client知道：自己的收发能力都没问题，Server收发能力也没问题，但此时Server端还不知道自己的发送能力是否有问题，所以需要第三次握手。</li><li>第三次握手：Client发送ACK包，Server收到Client发送的ACK包，此时Server知道：Client和自己的发送和接收能力都没问题，到此连接创建阶段完成。<br><strong>数据传输：</strong><br>连接建立完成后，双方开始收发业务数据。<br><strong>连接销毁（四次挥手）：</strong></li><li>第一次挥手：Client发送FIN包，请求断开连接，Server收到Client发送的FIN包，此时Server知道：Client已经没有新数据发送给自己了。</li><li>第二次挥手：Server发送ACK包，告诉Client自己已经收到了断开连接请求，Client收到Server发送的ACK包，此时Client知道：Server端收到了自己的断开连接请求，但是还不知道Server端有没有数据给自己。</li><li>第三次挥手：Server发送FIN包，告诉Client自己也没有数据需要传输了，Client收到Server发送的FIN包，此时Client知道：Server也没有数据需要发送给自己了，但是Server不知道自己是否收到了这个通知，所以需要第四次挥手。</li><li>第四次挥手：Client发送ACK包，告诉Server自己已经收到了通知，至此，双方都可以确认对端不会再有数据发送给自己，断开连接。<h4 id="TCP-—-为什么握手需要三次，而挥手需要四次"><a href="#TCP-—-为什么握手需要三次，而挥手需要四次" class="headerlink" title="TCP — 为什么握手需要三次，而挥手需要四次"></a>TCP — 为什么握手需要三次，而挥手需要四次</h4>TCP连接在传输数据前需要双方需要确定对端的收发能力是否正常，以此为前提则必须要握手三次，可以查看上面三次握手流程。<br>那么为什么断开连接需要四次挥手呢，因为创建连接与断开连接有个本质区别就是断开连接前是可能有数据在传输的，正常情况断开连接的流程是由Client触发的，Server突然收到断开连接的请求，然后返回ACK包告诉Client自己已经收到请求，但是Server需要检查是否有数据在传输，由于TCP连接是全双工的，所以双方需要确定都不会进行数据传输后才可以关闭，Server检查并处理完正在传输的数据以后会主动给Client发送FIN包，告诉Client自己也没数据需要传输了，已经准备好断开连接了，这一步就是多出来的那一次挥手。</li></ul><h2 id="应用层（Application-Layer）"><a href="#应用层（Application-Layer）" class="headerlink" title="应用层（Application Layer）"></a>应用层（Application Layer）</h2><p>应用程序收到传输层的数据，接下来就要进行解读，由于互联网是开放架构，大家都可以开发本身的应用程序，数据来源五花八门，必须事先规定好格式，否则根本无法解读。<br>因此产生了应用层，作用就是规定应用程序的数据格式，这是最高的一层，直接面对用户，它的数据就放在TCP/UDP数据包的Data部分，于是到了应用层以太网的数据包就变成下面这样：<br><img src="/basic/basic-3-network/../../images/basic/basic-3-network-ethernet+application.png" alt="" title="增加IP数据包、TCP数据包和应用层数据后的以太网协议结构"></p><h3 id="DHCP（Dynamic-Host-Configuration-Protocol）"><a href="#DHCP（Dynamic-Host-Configuration-Protocol）" class="headerlink" title="DHCP（Dynamic Host Configuration Protocol）"></a>DHCP（Dynamic Host Configuration Protocol）</h3><p><strong>DHCP — 动态主机配置协议</strong>，它的数据包结构如下：<br><img src="/basic/basic-3-network/../../images/basic/basic-3-network-dhcp.png" alt="" title="DHCP数据包结构"><br>DHCP是建立在UDP协议上的应用层协议，整个数据包形式为：<br><img src="/basic/basic-3-network/../../images/basic/basic-3-network-ethernet+ip+udp+dhcp.png" alt="" title="增加IP数据包、UDP数据包和DHCP数据包后的以太网协议结构"><br>DHCP采用客户端（67端口）／服务器模式（68端口），客户端通过DHCP协议和DHCP服务交换信息，服务器会返回分配给客户端的网络地址信息（IP、子网掩码、网关地址、DNS服务器等等）。<br>DHCP提供三种IP分配方式：</p><ul><li>自动分配是当DHCP客户端第一次成功的从DHCP服务器获取一个IP地址后，就永久的使用这个IP地址。</li><li>手动分配是由DHCP服务器管理员专门指定的IP地址。</li><li>动态分配是当客户端第一次从DHCP服务器获取到IP地址后，并非永久使用该地址，每次使用完后，DHCP客户端就需要释放这个IP，供其他客户端使用。<h3 id="DNS（Domain-Name-System）"><a href="#DNS（Domain-Name-System）" class="headerlink" title="DNS（Domain Name System）"></a>DNS（Domain Name System）</h3><strong>DNS — 域名系统</strong>，是因特网的一项核心服务，它作为可以将域名和IP地址相互映射的一个分布式数据库，能够使人更方便的访问互联网，而不用去记住能够被机器直接读取的IP数串，<strong>简单来说DNS就是维护域名与IP地址之间关系的系统。</strong><br>DNS协议使用了UDP和TCP两种协议，并占用对应协议的53端口，DNS数据包结构如下：<br><img src="/basic/basic-3-network/../../images/basic/basic-3-network-dns.png" alt="" title="DNS数据包结构"><br>增加了DNS数据包的以太网协议结构如下：<br><img src="/basic/basic-3-network/../../images/basic/basic-3-network-ethernet+ip+udp+tcp+dns.png" alt="" title="增加IP数据包、UDP/TCP数据包和DNS数据包后的以太网协议结构"><h3 id="Socket"><a href="#Socket" class="headerlink" title="Socket"></a>Socket</h3>我们知道两个进程如果需要进行通讯最基本的一个前提是能够唯一的标示一个进程，在本地进程通讯中我们可以使用PID来唯一标示一个进程，但PID只在本地唯一，网络中的两个进程PID冲突几率很大，这时候我们需要另辟它径了，我们知道网络层IP协议中的IP地址可以标识唯一主机，而传输层TCP/UDP协议的端口号可以唯一标示主机的一个进程，这样我们可以利用IP地址＋协议＋端口号精准标识出网络中的一个进程。<br>能够唯一标示网络中的进程后，它们就可以利用Socket进行通信了，什么是socket呢？<br>我们常常把Socket翻译为套接字，Socket是在应用层和传输层之间的一个抽象层，它把TCP/IP层复杂的操作抽象为几个简单的接口供应用层调用用来实现应用程序进程的网络通信。<br>Socket起源于UNIX，在UNIX一切皆文件哲学的思想下，Socket是一种<strong>打开—读/写—关闭</strong>模式的实现，服务器和客户端各自维护一个文件（SocketFD），在建立连接打开后，可以向本身文件写入内容供对方读取或者读取对方内容，通讯结束时关闭文件。</li></ul><h1 id="网络通信流程"><a href="#网络通信流程" class="headerlink" title="网络通信流程"></a>网络通信流程</h1><p>以访问<strong><a href="http://www.google.com" rel="external nofollow noopener noreferrer" target="_blank">www.google.com</a></strong>为例，来模拟一个完整的网络通信，用来梳理一下上面所讲到的知识。<br><strong>一台计算机要访问网络资源首先要连接网络，连接网络需要四个必要参数，IP地址、子网掩码、网关IP、DNS</strong>，获取IP地址分有两种方式，一是手动填写网络管理员分配的IP地址，二是通过DHCP服务动态获取IP地址，我们以第二种为例。</p><ol><li>通过DHCP服务获取IP地址、子网掩码、网关IP、DNS等网络信息，让计算机连接网络</li><li>然后浏览器输入网址<strong><a href="http://www.google.com" rel="external nofollow noopener noreferrer" target="_blank">www.google.com</a></strong>，经过DNS服务解析成目标主机的IP地址</li><li>由于访问www网址使用的是应用层的HTTP协议，浏览器生成HTTP请求数据包，假设生成HTTP请求包大小为2000字节。</li><li>HTTP数据包需要放置在传输层TCP协议的Data部分，TCP数据包Head部分需要设置通信双方的端口，HTTP协议默认端口80，所以目标端口为80，源端口为本机随机生成（1023 ~ 65535），由于TCP协议的Head部分为定长20字节，所以目前的数据包大小为2020字节。</li><li>然后TCP数据包需要放置在IP数据包的Data部分，IP数据包Head部分需要设置通信双方的IP地址，本机IP地址通过DHCP已经得知，目标主机IP地址通过DNS服务也知道了，由于IP协议的Head部分为定长20字节，所以目前的数据大小为2040字节。</li><li>最后IP数据包放置在数据链路层以太网帧的Data部分，以太网数据包Head部分需要设置通信双方的MAC地址，源MAC地址为本机网卡的MAC地址，目标MAC地址通过ARP协议得到，由于DNS服务返回<strong><a href="http://www.google.com" rel="external nofollow noopener noreferrer" target="_blank">www.google.com</a></strong>域名所对应的IP地址与本机IP不在同一子网，所以在发送ARP请求时ARP协议中的目标IP地址为本机所在子网的网关IP（DHCP返回），目标MAC地址则为<strong>FF:FF:FF:FF:FF:FF</strong>，表明这是一个广播地址。</li><li>由于以太网协议规定Data部分最大为1500字节，但是目前数据有2040字节，所以会分成两包发送。</li><li>经过多个网关的转发，google服务器收到来自我们本机的发送的两个以太网数帧，根据IP数据包Head部分的序号将两包数据拼接起来，取出完整的TCP数据，然后读取TCP数据包里面的的HTTP请求数据，接着做出HTTP响应，在用TCP协议发送回来，响应步骤和我们发送步骤一样，本机接收到来自google服务器的响应数据以后，将网页显示出来，到此，一次网络通讯就结束了。</li></ol></div><div><div id="wechat_subscriber" style="display:block;padding:10px 0;margin:20px auto;width:100%;text-align:center"> <img id="wechat_subscriber_qcode" src="/uploads/wechat-qcode.jpg" alt="Choice wechat" style="width:200px;max-width:100%"><div>关注公众号，获取文章更新通知。</div></div></div><div><div><div style="text-align:center;color:#ccc;font-size:14px">-------------本文结束<i class="fa fa-paw"></i>感谢您的阅读-------------</div></div></div><div><div style="padding:10px 0;margin:20px auto;width:90%;text-align:center"><div>坚持原创技术分享，您的支持将鼓励我继续创作！</div> <button id="rewardButton" disable="enable" onclick='var qr=document.getElementById("QR");"none"===qr.style.display?qr.style.display="block":qr.style.display="none"'> <span>打赏</span></button><div id="QR" style="display:none"><div id="wechat" style="display:inline-block"> <img id="wechat_qr" src="/uploads/wechatpay.png" alt="Choice 微信支付"><p>微信支付</p></div><div id="alipay" style="display:inline-block"> <img id="alipay_qr" src="/uploads/alipay.png" alt="Choice 支付宝"><p>支付宝</p></div></div></div></div><div><ul class="post-copyright"><li class="post-copyright-author"> <strong>本文作者：</strong> Choice</li><li class="post-copyright-link"> <strong>本文链接：</strong> <a href="http://blog.onlinetool.com.cn/basic/basic-3-network/" title="计算机基础(3) --- 网络协议">http://blog.onlinetool.com.cn/basic/basic-3-network/</a></li><li class="post-copyright-license"> <strong>版权声明：</strong> 本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/3.0/" rel="external nofollow noopener noreferrer" target="_blank">CC BY-NC-SA 3.0</a> 许可协议。转载请注明出处！</li></ul></div><footer class="post-footer"><div class="post-tags"> <a href="/tags/计算机基础/" rel="tag"># 计算机基础</a> <a href="/tags/网络协议/" rel="tag"># 网络协议</a> <a href="/tags/互联网/" rel="tag"># 互联网</a></div><div class="post-nav"><div class="post-nav-next post-nav-item"><a href="/basic/basic-2-os/" rel="next" title="计算机基础(2) --- 操作系统"><i class="fa fa-chevron-left"></i> 计算机基础(2) --- 操作系统</a></div><span class="post-nav-divider"></span><div class="post-nav-prev post-nav-item"> <a href="/basic/basic-1-hardware/" rel="prev" title="计算机基础(1) --- 计算机硬件">计算机基础(1) --- 计算机硬件<i class="fa fa-chevron-right"></i></a></div></div></footer></div></article><div class="post-spread"></div></div></div><div class="comments" id="comments"></div></div><div class="sidebar-toggle"><div class="sidebar-toggle-line-wrap"><span class="sidebar-toggle-line sidebar-toggle-line-first"></span><span class="sidebar-toggle-line sidebar-toggle-line-middle"></span><span class="sidebar-toggle-line sidebar-toggle-line-last"></span></div></div><aside id="sidebar" class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap"> 文章目录</li><li class="sidebar-nav-overview" data-target="site-overview-wrap"> 站点概览</li></ul><section class="site-overview-wrap sidebar-panel"><div class="site-overview"><div class="site-author motion-element" itemprop="author" itemscope="" itemtype="http://schema.org/Person"> <img class="site-author-image" itemprop="image" src="/uploads/portrait.png" alt="Choice"><p class="site-author-name" itemprop="name">Choice</p><p class="site-description motion-element" itemprop="description"></p></div><nav class="site-state motion-element"><div class="site-state-item site-state-posts"> <a href="/archives/"><span class="site-state-item-count">15</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"> <a href="/categories/index.html"><span class="site-state-item-count">5</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"> <a href="/tags/index.html"><span class="site-state-item-count">18</span> <span class="site-state-item-name">标签</span></a></div></nav><div class="feed-link motion-element"><a href="/atom.xml" rel="alternate"><i class="fa fa-rss"></i> RSS</a></div><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="https://github.com/ch0ice" target="_blank" title="GitHub" rel="external nofollow noopener noreferrer"><i class="fa fa-fw fa-github"></i> GitHub</a></span><span class="links-of-author-item"><a href="mailto:liuzeyuan@163.com" target="_blank" title="邮箱" rel="external nofollow noopener noreferrer"><i class="fa fa-fw fa-envelope"></i> 邮箱</a></span><span class="links-of-author-item"><a href="https://weibo.com/ITwuqing?topnav=1&wvr=6&topsug=1&is_hot=1" target="_blank" title="微博" rel="external nofollow noopener noreferrer"><i class="fa fa-fw fa-weibo"></i> 微博</a></span><span class="links-of-author-item"><a href="https://www.zhihu.com/people/mr_liuzeyuan/activities" target="_blank" title="知乎" rel="external nofollow noopener noreferrer"><i class="fa fa-fw fa-book"></i> 知乎</a></span></div></div></section><section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active"><div class="post-toc"><div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#前言"><span class="nav-number">1.</span> <span class="nav-text">前言</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#网络模型划分"><span class="nav-number">2.</span> <span class="nav-text">网络模型划分</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#七层网络模型-—-OSI（Open-System-Interconnection）"><span class="nav-number">3.</span> <span class="nav-text">七层网络模型 — OSI（Open System Interconnection）</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#四层网络模型-—-TCP-IP"><span class="nav-number">4.</span> <span class="nav-text">四层网络模型 — TCP/IP</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#五层网络模型-—-TCP-IP"><span class="nav-number">5.</span> <span class="nav-text">五层网络模型 — TCP/IP</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#物理层（Physical-Layer）"><span class="nav-number">5.1.</span> <span class="nav-text">物理层（Physical Layer）</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#数据链路层（Data-Link-Layer）"><span class="nav-number">5.2.</span> <span class="nav-text">数据链路层（Data Link Layer）</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#以太网协议（Ethernet-Protocol）"><span class="nav-number">5.2.1.</span> <span class="nav-text">以太网协议（Ethernet Protocol）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#MAC地址（Media-Access-Control-Address）"><span class="nav-number">5.2.2.</span> <span class="nav-text">MAC地址（Media Access Control Address）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#广播（Broadcasting）"><span class="nav-number">5.2.3.</span> <span class="nav-text">广播（Broadcasting）</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#网络层（Network-Layer）"><span class="nav-number">5.3.</span> <span class="nav-text">网络层（Network Layer）</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#IP协定"><span class="nav-number">5.3.1.</span> <span class="nav-text">IP协定</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#子网掩码"><span class="nav-number">5.3.2.</span> <span class="nav-text">子网掩码</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#IP数据包"><span class="nav-number">5.3.3.</span> <span class="nav-text">IP数据包</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ARP（Address-Resolution-Protocol）-RARP（Reverse-Address-Resolution-Protocol）"><span class="nav-number">5.3.4.</span> <span class="nav-text">ARP（Address Resolution Protocol）/RARP（Reverse Address Resolution Protocol）</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#传输层（Transport-Layer）"><span class="nav-number">5.4.</span> <span class="nav-text">传输层（Transport Layer）</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#UDP（User-Datagram-Protocol）"><span class="nav-number">5.4.1.</span> <span class="nav-text">UDP（User Datagram Protocol）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#TCP（Transmission-Control-Protocol）"><span class="nav-number">5.4.2.</span> <span class="nav-text">TCP（Transmission Control Protocol）</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#TCP-—-三次握手四次挥手"><span class="nav-number">5.4.2.1.</span> <span class="nav-text">TCP — 三次握手四次挥手</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#TCP-—-为什么握手需要三次，而挥手需要四次"><span class="nav-number">5.4.2.2.</span> <span class="nav-text">TCP — 为什么握手需要三次，而挥手需要四次</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#应用层（Application-Layer）"><span class="nav-number">5.5.</span> <span class="nav-text">应用层（Application Layer）</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#DHCP（Dynamic-Host-Configuration-Protocol）"><span class="nav-number">5.5.1.</span> <span class="nav-text">DHCP（Dynamic Host Configuration Protocol）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#DNS（Domain-Name-System）"><span class="nav-number">5.5.2.</span> <span class="nav-text">DNS（Domain Name System）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Socket"><span class="nav-number">5.5.3.</span> <span class="nav-text">Socket</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#网络通信流程"><span class="nav-number">6.</span> <span class="nav-text">网络通信流程</span></a></li></ol></div></div></section></div></aside></div></main><footer id="footer" class="footer"><div class="footer-inner"><script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div class="copyright">&copy; 2018 &mdash; <span itemprop="copyrightYear">2020</span><span class="with-love" id="animate"><i class="fa fa-heart"></i></span> <span class="author" itemprop="copyrightHolder">Choice</span> <span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-area-chart"></i></span> <span class="post-meta-item-text">Site words total count&#58;</span> <span title="Site words total count">33.4k</span></div><div class="powered-by"><i class="fa fa-user-md"></i> <span id="busuanzi_container_site_uv">本站访客数:<span id="busuanzi_value_site_uv"></span> 次</span></div> <span class="post-meta-divider">|</span><div class="powered-by"> <span id="busuanzi_container_site_pv">本站总访问量:<span id="busuanzi_value_site_pv"></span> 次</span></div></div></footer><div class="back-to-top"><i class="fa fa-arrow-up"></i></div></div><script type="text/javascript">"[object Function]"!==Object.prototype.toString.call(window.Promise)&&(window.Promise=null)</script><script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script><script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script><script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script><script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script><script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script><script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script><script id="ribbon" type="text/javascript" size="300" alpha="0.6" zindex="-1" src="/lib/canvas-ribbon/canvas-ribbon.js"></script><script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><script type="text/javascript">
    var GUEST = ['nick','mail','link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item=>{
      return GUEST.indexOf(item)>-1;
    });
    new Valine({
        el: '#comments' ,
        verify: false,
        notify: false,
        appId: '9SHSaI9JxokTuIBAUR71UrFK-gzGzoHsz',
        appKey: 'SACKdrI10MKOqjRl0GzdREWg',
        placeholder: 'Just go go',
        avatar:'retro',
        guest_info:guest,
        pageSize:'10' || 10,
    });
  </script><script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script><script>!function(){var t=document.createElement("script"),e=window.location.protocol.split(":")[0];t.src="https"===e?"https://zz.bdstatic.com/linksubmit/push.js":"http://push.zhanzhang.baidu.com/push.js";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(t,s)}()</script></body></html>